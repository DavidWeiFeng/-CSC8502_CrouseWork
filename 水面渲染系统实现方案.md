# æ°´é¢æ¸²æŸ“ç³»ç»Ÿ - å®ç°æ–¹æ¡ˆ

**ç›®æ ‡**ï¼šä¸ºæµ·æ´‹ä¸»é¢˜å¤©ç©ºç›’åœºæ™¯æ·»åŠ çœŸå®çš„æ°´å¹³é¢ï¼Œè§£å†³åœ°å½¢æ‚¬æµ®é—®é¢˜

**æ—¥æœŸ**ï¼š2025-10-29
**ä¼˜å…ˆçº§**ï¼šâ­â­â­ é«˜ï¼ˆå½±å“è§†è§‰æ•ˆæœå’Œç¯å¢ƒæ˜ å°„åŠŸèƒ½ï¼‰

---

## ğŸ¯ é—®é¢˜åˆ†æ

### å½“å‰é—®é¢˜
1. âœ… æµ·æ´‹ä¸»é¢˜å¤©ç©ºç›’å·²å®Œæˆï¼ˆåº•éƒ¨æ˜¯æµ·æ´‹ï¼‰
2. âŒ åœ°å½¢ Y è½´é«˜åº¦æ¯”å¤©ç©ºç›’åº•éƒ¨é«˜
3. âŒ çœ‹èµ·æ¥åƒé™†åœ°æ‚¬æµ®åœ¨æµ·æ´‹ä¸Š
4. âŒ ç¼ºå°‘çœŸå®çš„æ°´å¹³é¢

### è§£å†³æ–¹å‘
1. **è°ƒæ•´åœ°å½¢é«˜åº¦æ˜ å°„** - è®©åœ°å½¢æœ‰é«˜æœ‰ä½ï¼Œéƒ¨åˆ†åœ¨æ°´é¢ä¸‹
2. **åˆ›å»ºæ°´å¹³é¢ç³»ç»Ÿ** - å®ç°å¯äº¤äº’ã€æœ‰è§†è§‰æ•ˆæœçš„æ°´é¢
3. **å®ç°æ°´é¢æ•ˆæœ** - åå°„ã€æŠ˜å°„ã€æ³¢æµªåŠ¨ç”»

---

## ğŸ“‹ å®ç°æ–¹æ¡ˆï¼ˆä¸‰ä¸ªç‰ˆæœ¬ï¼‰

### æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | éš¾åº¦ | å®ç°æ—¶é—´ | è§†è§‰æ•ˆæœ | æ¨èåº¦ |
|------|------|----------|----------|--------|
| **æ–¹æ¡ˆ1ï¼šåŸºç¡€æ°´é¢** | ä½ | 0.5å¤© | â­â­ | é€‚åˆå¿«é€ŸåŸå‹ |
| **æ–¹æ¡ˆ2ï¼šåå°„æ°´é¢** | ä¸­ | 1-1.5å¤© | â­â­â­â­ | â­â­â­ æ¨è |
| **æ–¹æ¡ˆ3ï¼šå®Œæ•´æ°´é¢** | é«˜ | 2-3å¤© | â­â­â­â­â­ | æ—¶é—´å……è¶³æ—¶ |

---

## ğŸš€ æ–¹æ¡ˆ1ï¼šåŸºç¡€æ°´é¢ï¼ˆå¿«é€Ÿå®ç°ï¼‰

**ç‰¹ç‚¹**ï¼šç®€å•ã€å¿«é€Ÿã€æ»¡è¶³åŸºæœ¬éœ€æ±‚

### å®ç°å†…å®¹

#### 1. è°ƒæ•´åœ°å½¢é«˜åº¦
```cpp
// åœ¨ Terrain.cpp çš„é«˜åº¦è®¡ç®—ä¸­è°ƒæ•´
float height = pixelValue * heightScale - heightOffset;
// æ¨èå‚æ•°ï¼š
// heightScale = 20.0fï¼ˆåŸæ¥å¯èƒ½æ˜¯30-50ï¼‰
// heightOffset = 10.0fï¼ˆæ–°å¢ï¼Œè®©åœ°å½¢æœ‰è´Ÿå€¼åŒºåŸŸï¼‰
```

**æ•ˆæœ**ï¼šåœ°å½¢æœ‰çš„åœ°æ–¹åœ¨æ°´é¢ä¸Šï¼ˆå²›å±¿ï¼‰ï¼Œæœ‰çš„åœ°æ–¹åœ¨æ°´é¢ä¸‹ï¼ˆæµ·åº•ï¼‰

#### 2. åˆ›å»ºç®€å•æ°´å¹³é¢
åˆ›å»º `WaterPlane` ç±»ï¼š

**æ–‡ä»¶ç»“æ„ï¼š**
- `WaterPlane.h` - æ°´é¢ç±»å£°æ˜
- `WaterPlane.cpp` - æ°´é¢ç±»å®ç°
- `Shaders/waterVertex.glsl` - æ°´é¢é¡¶ç‚¹ç€è‰²å™¨
- `Shaders/waterFragment.glsl` - æ°´é¢ç‰‡æ®µç€è‰²å™¨

**WaterPlane ç±»ï¼ˆç®€åŒ–ç‰ˆï¼‰ï¼š**
```cpp
class WaterPlane {
private:
    unsigned int VAO, VBO, EBO;
    float waterLevel;  // æ°´é¢é«˜åº¦ (å¦‚ Y = 0.0)
    float waterSize;   // æ°´é¢å¤§å° (å¦‚ 500x500)

public:
    WaterPlane(float level, float size);
    void Render(Shader& shader);
};
```

#### 3. æ°´é¢ç€è‰²å™¨ï¼ˆåŸºç¡€ç‰ˆï¼‰

**é¡¶ç‚¹ç€è‰²å™¨ï¼š**
```glsl
#version 330 core
layout(location = 0) in vec3 aPos;
layout(location = 1) in vec2 aTexCoord;

out vec2 TexCoord;

uniform mat4 model;
uniform mat4 view;
uniform mat4 projection;
uniform float time;  // ç”¨äºæ³¢æµªåŠ¨ç”»

void main() {
    vec3 pos = aPos;

    // ç®€å•çš„æ­£å¼¦æ³¢æµª
    pos.y += sin(pos.x * 0.5 + time) * 0.3;
    pos.y += cos(pos.z * 0.5 + time) * 0.3;

    gl_Position = projection * view * model * vec4(pos, 1.0);
    TexCoord = aTexCoord;
}
```

**ç‰‡æ®µç€è‰²å™¨ï¼š**
```glsl
#version 330 core
out vec4 FragColor;

in vec2 TexCoord;

uniform sampler2D waterTexture;  // æ°´çº¹ç†ï¼ˆå¯é€‰ï¼‰
uniform vec3 waterColor;         // æ°´çš„é¢œè‰²
uniform float alpha;             // é€æ˜åº¦

void main() {
    // ç®€å•çš„è“è‰²æ°´é¢
    vec3 color = waterColor; // vec3(0.1, 0.3, 0.5)

    FragColor = vec4(color, alpha);  // alpha = 0.6-0.8
}
```

#### 4. æ¸²æŸ“é…ç½®

**åœ¨ main.cpp ä¸­çš„æ¸²æŸ“é¡ºåºï¼š**
```cpp
// 1. æ¸²æŸ“ä¸é€æ˜ç‰©ä½“
terrain.Render(terrainShader);

// 2. å¯ç”¨æ··åˆæ¨¡å¼
glEnable(GL_BLEND);
glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);

// 3. æ¸²æŸ“æ°´é¢
waterPlane.Render(waterShader);

// 4. å…³é—­æ··åˆ
glDisable(GL_BLEND);

// 5. æ¸²æŸ“å¤©ç©ºç›’
skybox.Render(skyboxShader);
```

### ä¼˜ç‚¹
- âœ… å®ç°å¿«é€Ÿï¼ˆåŠå¤©ï¼‰
- âœ… ä»£ç ç®€å•
- âœ… è§£å†³æ‚¬æµ®é—®é¢˜

### ç¼ºç‚¹
- âŒ æ— åå°„æ•ˆæœ
- âŒ è§†è§‰æ•ˆæœä¸€èˆ¬
- âŒ ä¸èƒ½ç”¨äºç¯å¢ƒæ˜ å°„æ¼”ç¤º

**é¢„è®¡æ—¶é—´ï¼š0.5å¤©**

---

## ğŸŒŸ æ–¹æ¡ˆ2ï¼šåå°„æ°´é¢ï¼ˆæ¨èâ­ï¼‰

**ç‰¹ç‚¹**ï¼šè§†è§‰æ•ˆæœå¥½ï¼Œæ»¡è¶³è¯¾ç¨‹è¦æ±‚ï¼ˆç¯å¢ƒæ˜ å°„ï¼‰

### å®ç°å†…å®¹

#### 1. æ°´é¢åå°„åŸç†
- ä½¿ç”¨å¤©ç©ºç›’ï¼ˆCubemapï¼‰ä½œä¸ºç¯å¢ƒè´´å›¾
- è®¡ç®—è§†çº¿åˆ°æ°´é¢çš„åå°„å‘é‡
- é‡‡æ ·å¤©ç©ºç›’å¾—åˆ°åå°„é¢œè‰²
- æ··åˆåå°„è‰²å’Œæ°´çš„åŸºç¡€è‰²

#### 2. WaterPlane ç±»ï¼ˆåå°„ç‰ˆï¼‰

```cpp
class WaterPlane {
private:
    unsigned int VAO, VBO, EBO;
    float waterLevel;
    float waterSize;

    // æ°´é¢ç½‘æ ¼ï¼ˆç”¨äºæ³•å‘é‡è®¡ç®—ï¼‰
    int gridResolution;  // å¦‚ 100x100

public:
    WaterPlane(float level, float size, int resolution);
    void Render(Shader& shader, unsigned int skyboxTexture);
    void Update(float deltaTime);  // æ›´æ–°æ³¢æµª
};
```

#### 3. æ°´é¢ç€è‰²å™¨ï¼ˆåå°„ç‰ˆï¼‰

**é¡¶ç‚¹ç€è‰²å™¨ï¼š**
```glsl
#version 330 core
layout(location = 0) in vec3 aPos;
layout(location = 1) in vec3 aNormal;
layout(location = 2) in vec2 aTexCoord;

out vec3 FragPos;
out vec3 Normal;
out vec2 TexCoord;
out vec3 ViewDir;

uniform mat4 model;
uniform mat4 view;
uniform mat4 projection;
uniform vec3 viewPos;
uniform float time;

void main() {
    vec3 pos = aPos;

    // æ›´å¤æ‚çš„æ³¢æµªï¼ˆå¤šä¸ªæ­£å¼¦æ³¢å åŠ ï¼‰
    float wave1 = sin(pos.x * 0.3 + time * 0.5) * 0.2;
    float wave2 = cos(pos.z * 0.4 + time * 0.6) * 0.15;
    float wave3 = sin((pos.x + pos.z) * 0.2 + time * 0.4) * 0.1;
    pos.y += wave1 + wave2 + wave3;

    // è®¡ç®—æ‰°åŠ¨åçš„æ³•å‘é‡ï¼ˆè¿‘ä¼¼ï¼‰
    vec3 normal = aNormal;
    normal.x += cos(pos.x * 0.3 + time * 0.5) * 0.3;
    normal.z += sin(pos.z * 0.4 + time * 0.6) * 0.3;
    normal = normalize(normal);

    FragPos = vec3(model * vec4(pos, 1.0));
    Normal = mat3(transpose(inverse(model))) * normal;
    TexCoord = aTexCoord;
    ViewDir = viewPos - FragPos;

    gl_Position = projection * view * vec4(FragPos, 1.0);
}
```

**ç‰‡æ®µç€è‰²å™¨ï¼š**
```glsl
#version 330 core
out vec4 FragColor;

in vec3 FragPos;
in vec3 Normal;
in vec2 TexCoord;
in vec3 ViewDir;

uniform samplerCube skybox;       // å¤©ç©ºç›’ç«‹æ–¹ä½“è´´å›¾
uniform sampler2D waterNormalMap; // æ°´çš„æ³•çº¿è´´å›¾ï¼ˆå¯é€‰ï¼‰
uniform vec3 waterColor;
uniform float time;

void main() {
    vec3 norm = normalize(Normal);
    vec3 viewDir = normalize(ViewDir);

    // è®¡ç®—åå°„å‘é‡
    vec3 reflectDir = reflect(-viewDir, norm);

    // ä»å¤©ç©ºç›’é‡‡æ ·åå°„é¢œè‰²
    vec3 reflectionColor = texture(skybox, reflectDir).rgb;

    // æ°´çš„åŸºç¡€é¢œè‰²
    vec3 baseColor = waterColor; // vec3(0.1, 0.3, 0.5)

    // è®¡ç®—è²æ¶…å°”æ•ˆåº”ï¼ˆè¾¹ç¼˜æ›´é€æ˜ï¼Œä¸­å¿ƒæ›´åå°„ï¼‰
    float fresnel = pow(1.0 - max(dot(viewDir, norm), 0.0), 3.0);

    // æ··åˆåå°„å’ŒåŸºç¡€è‰²
    vec3 finalColor = mix(baseColor, reflectionColor, fresnel * 0.7);

    // æ ¹æ®è§‚å¯Ÿè§’åº¦è°ƒæ•´é€æ˜åº¦
    float alpha = 0.7 + fresnel * 0.3;

    FragColor = vec4(finalColor, alpha);
}
```

#### 4. æ¸²æŸ“é›†æˆ

```cpp
// åœ¨ main.cpp æ¸²æŸ“å¾ªç¯ä¸­

// 1. æ¸²æŸ“å¤©ç©ºç›’ï¼ˆå…ˆæ¸²æŸ“ï¼Œç”¨äºåå°„ï¼‰
skybox.Render(skyboxShader);

// 2. æ¸²æŸ“åœ°å½¢
terrain.Render(terrainShader);

// 3. æ¸²æŸ“åå°„æ°´é¢
glEnable(GL_BLEND);
glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);
glDepthMask(GL_FALSE); // ä¸å†™å…¥æ·±åº¦ï¼ˆæ°´é¢åŠé€æ˜ï¼‰

waterShader.Use();
waterShader.SetFloat("time", glfwGetTime());
waterShader.SetVec3("viewPos", camera.Position);
waterShader.SetVec3("waterColor", glm::vec3(0.1f, 0.3f, 0.5f));

// ç»‘å®šå¤©ç©ºç›’çº¹ç†ç”¨äºåå°„
glActiveTexture(GL_TEXTURE0);
glBindTexture(GL_TEXTURE_CUBE_MAP, skybox.GetTextureID());
waterShader.SetInt("skybox", 0);

waterPlane.Render(waterShader);

glDepthMask(GL_TRUE);
glDisable(GL_BLEND);
```

### ä¼˜ç‚¹
- âœ… è§†è§‰æ•ˆæœä¼˜ç§€
- âœ… æ»¡è¶³"ç¯å¢ƒæ˜ å°„"è¯¾ç¨‹è¦æ±‚
- âœ… æœ‰åŠ¨æ€æ³¢æµª
- âœ… æœ‰è²æ¶…å°”æ•ˆæœ

### ç¼ºç‚¹
- âš ï¸ éœ€è¦ä¿®æ”¹ Skybox ç±»æš´éœ²çº¹ç† ID
- âš ï¸ éœ€è¦è°ƒè¯•åå°„æ•ˆæœ

**é¢„è®¡æ—¶é—´ï¼š1-1.5å¤©**

---

## ğŸ¨ æ–¹æ¡ˆ3ï¼šå®Œæ•´æ°´é¢ç³»ç»Ÿï¼ˆé«˜çº§ï¼‰

**ç‰¹ç‚¹**ï¼šçœŸå®æ„Ÿæœ€å¼ºï¼Œé€‚åˆè¿½æ±‚å®Œç¾çš„æƒ…å†µ

### é¢å¤–å®ç°å†…å®¹

#### 1. åŒé‡æ¸²æŸ“ï¼ˆåå°„ + æŠ˜å°„ï¼‰
- **åå°„çº¹ç†**ï¼šæ¸²æŸ“æ°´é¢ä¸Šæ–¹åœºæ™¯çš„å€’å½±
- **æŠ˜å°„çº¹ç†**ï¼šæ¸²æŸ“æ°´é¢ä¸‹æ–¹åœºæ™¯çš„æ‰­æ›²

**éœ€è¦ 2 ä¸ª FBOï¼ˆå¸§ç¼“å†²å¯¹è±¡ï¼‰ï¼š**
```cpp
class WaterFrameBuffer {
private:
    unsigned int reflectionFBO;  // åå°„å¸§ç¼“å†²
    unsigned int refractionFBO;  // æŠ˜å°„å¸§ç¼“å†²
    unsigned int reflectionTexture;
    unsigned int refractionTexture;

public:
    void BindReflectionFBO();
    void BindRefractionFBO();
    void UnbindFBO();
};
```

#### 2. æ¸²æŸ“æµç¨‹

```cpp
// === ç¬¬1æ­¥ï¼šæ¸²æŸ“åå°„çº¹ç† ===
waterFBO.BindReflectionFBO();
camera.InvertPitch();  // ç¿»è½¬ç›¸æœº
// åªæ¸²æŸ“æ°´é¢ä¸Šæ–¹çš„ç‰©ä½“ï¼ˆè£å‰ªå¹³é¢ï¼‰
terrain.Render(terrainShader);
skybox.Render(skyboxShader);
camera.InvertPitch();  // æ¢å¤ç›¸æœº

// === ç¬¬2æ­¥ï¼šæ¸²æŸ“æŠ˜å°„çº¹ç† ===
waterFBO.BindRefractionFBO();
// åªæ¸²æŸ“æ°´é¢ä¸‹æ–¹çš„ç‰©ä½“ï¼ˆè£å‰ªå¹³é¢ï¼‰
terrain.Render(terrainShader);

// === ç¬¬3æ­¥ï¼šæ¸²æŸ“æ­£å¸¸åœºæ™¯ + æ°´é¢ ===
waterFBO.UnbindFBO();
terrain.Render(terrainShader);

// ä½¿ç”¨åå°„å’ŒæŠ˜å°„çº¹ç†æ¸²æŸ“æ°´é¢
waterShader.Use();
glActiveTexture(GL_TEXTURE0);
glBindTexture(GL_TEXTURE_2D, waterFBO.reflectionTexture);
glActiveTexture(GL_TEXTURE1);
glBindTexture(GL_TEXTURE_2D, waterFBO.refractionTexture);
waterPlane.Render(waterShader);

skybox.Render(skyboxShader);
```

#### 3. å®Œæ•´æ°´é¢ç€è‰²å™¨

**ç‰‡æ®µç€è‰²å™¨ï¼š**
```glsl
#version 330 core
out vec4 FragColor;

in vec3 FragPos;
in vec3 Normal;
in vec2 TexCoord;
in vec4 ClipSpace;

uniform sampler2D reflectionTexture;
uniform sampler2D refractionTexture;
uniform sampler2D dudvMap;         // DuDv è´´å›¾ï¼ˆæ‰­æ›²ï¼‰
uniform sampler2D normalMap;       // æ³•çº¿è´´å›¾
uniform float moveFactor;          // æ³¢æµªç§»åŠ¨å› å­
uniform vec3 viewPos;

void main() {
    // å½’ä¸€åŒ–è®¾å¤‡åæ ‡
    vec2 ndc = (ClipSpace.xy / ClipSpace.w) * 0.5 + 0.5;

    // DuDv æ‰­æ›²ï¼ˆæ¨¡æ‹Ÿæ³¢æµªï¼‰
    vec2 distortion = texture(dudvMap, vec2(TexCoord.x + moveFactor, TexCoord.y)).rg * 0.1;
    distortion = TexCoord + vec2(distortion.x, distortion.y + moveFactor);
    vec2 totalDistortion = (texture(dudvMap, distortion).rg * 2.0 - 1.0) * 0.02;

    // é‡‡æ ·åå°„å’ŒæŠ˜å°„çº¹ç†
    vec2 reflectCoords = vec2(ndc.x, 1.0 - ndc.y) + totalDistortion;
    vec2 refractCoords = ndc + totalDistortion;
    reflectCoords = clamp(reflectCoords, 0.001, 0.999);
    refractCoords = clamp(refractCoords, 0.001, 0.999);

    vec4 reflectColor = texture(reflectionTexture, reflectCoords);
    vec4 refractColor = texture(refractionTexture, refractCoords);

    // è²æ¶…å°”æ•ˆåº”
    vec3 viewDir = normalize(viewPos - FragPos);
    vec3 normal = texture(normalMap, distortion).rgb;
    normal = normalize(normal * 2.0 - 1.0);
    float fresnel = pow(1.0 - dot(viewDir, vec3(0, 1, 0)), 2.0);

    // æ··åˆåå°„å’ŒæŠ˜å°„
    vec4 finalColor = mix(reflectColor, refractColor, fresnel);

    // æ·»åŠ è½»å¾®çš„è“è‰²è°ƒ
    finalColor = mix(finalColor, vec4(0.0, 0.3, 0.5, 1.0), 0.2);

    FragColor = finalColor;
}
```

### ä¼˜ç‚¹
- âœ… çœŸå®æ„Ÿæå¼º
- âœ… åŠ¨æ€åå°„æŠ˜å°„
- âœ… å¯ä»¥çœ‹åˆ°æ°´ä¸‹åœ°å½¢

### ç¼ºç‚¹
- âŒ å®ç°å¤æ‚
- âŒ æ€§èƒ½å¼€é”€å¤§
- âŒ è°ƒè¯•å›°éš¾

**é¢„è®¡æ—¶é—´ï¼š2-3å¤©**

---

## ğŸ“Š æ¨èå®æ–½è·¯çº¿

### ğŸ¯ æ¨èï¼š**æ¸è¿›å¼å®ç°**

**ç¬¬1é˜¶æ®µï¼ˆ0.5å¤©ï¼‰ï¼šå¿«é€Ÿè§£å†³æ‚¬æµ®é—®é¢˜**
1. è°ƒæ•´åœ°å½¢é«˜åº¦å‚æ•°ï¼ˆè®©éƒ¨åˆ†åœ°å½¢åœ¨æ°´é¢ä¸‹ï¼‰
2. å®ç°æ–¹æ¡ˆ1ï¼ˆåŸºç¡€æ°´é¢ï¼‰
3. **ç›®æ ‡**ï¼šåœºæ™¯çœ‹èµ·æ¥åˆç†

**ç¬¬2é˜¶æ®µï¼ˆ1å¤©ï¼‰ï¼šæ·»åŠ åå°„æ•ˆæœ**
1. å‡çº§åˆ°æ–¹æ¡ˆ2ï¼ˆåå°„æ°´é¢ï¼‰
2. é›†æˆå¤©ç©ºç›’åå°„
3. **ç›®æ ‡**ï¼šæ»¡è¶³"ç¯å¢ƒæ˜ å°„"è¦æ±‚

**ç¬¬3é˜¶æ®µï¼ˆå¯é€‰ï¼Œ1-2å¤©ï¼‰ï¼šè¿½æ±‚å®Œç¾**
1. å¦‚æœæ—¶é—´å……è¶³ï¼Œå‡çº§åˆ°æ–¹æ¡ˆ3
2. **ç›®æ ‡**ï¼šè§†è§‰æ•ˆæœæœ€ä½³

---

## ğŸ› ï¸ å…·ä½“å®æ–½æ­¥éª¤ï¼ˆæ–¹æ¡ˆ2ï¼‰

### Step 1: è°ƒæ•´åœ°å½¢é«˜åº¦ï¼ˆ15åˆ†é’Ÿï¼‰

**ä¿®æ”¹ `Terrain.cpp`ï¼š**
```cpp
// åœ¨ç”Ÿæˆåœ°å½¢çš„å¾ªç¯ä¸­
float pixelValue = heightData[index] / 255.0f;

// åŸæ¥ï¼š
// float height = pixelValue * 30.0f;

// æ”¹ä¸ºï¼š
float heightScale = 20.0f;
float heightOffset = 8.0f;  // è®©æ°´é¢å¤„äº Y = 0
float height = pixelValue * heightScale - heightOffset;

// è¿™æ ·é«˜åº¦èŒƒå›´ï¼š-8.0 åˆ° 12.0
// æ°´é¢è®¾åœ¨ Y = 0.0
```

### Step 2: åˆ›å»º WaterPlane ç±»ï¼ˆ1å°æ—¶ï¼‰

**åˆ›å»ºæ–‡ä»¶ï¼š**
- `8502_CrouseWork/WaterPlane.h`
- `8502_CrouseWork/WaterPlane.cpp`

**WaterPlane.h åŸºæœ¬ç»“æ„ï¼š**
```cpp
#ifndef WATERPLANE_H
#define WATERPLANE_H

#include <glad/glad.h>
#include <glm/glm.hpp>
#include "Shader.h"

class WaterPlane {
public:
    WaterPlane(float level, float size, int resolution);
    ~WaterPlane();

    void Render(Shader& shader);
    void Update(float deltaTime);

private:
    unsigned int VAO, VBO, EBO;
    float waterLevel;
    float size;
    int resolution;
    int indexCount;

    void GenerateMesh();
};

#endif
```

### Step 3: ç¼–å†™æ°´é¢ç€è‰²å™¨ï¼ˆ30åˆ†é’Ÿï¼‰

**åˆ›å»ºæ–‡ä»¶ï¼š**
- `8502_CrouseWork/Shaders/waterVertex.glsl`
- `8502_CrouseWork/Shaders/waterFragment.glsl`

ï¼ˆä½¿ç”¨ä¸Šé¢æ–¹æ¡ˆ2çš„ç€è‰²å™¨ä»£ç ï¼‰

### Step 4: ä¿®æ”¹ Skybox ç±»ï¼ˆ15åˆ†é’Ÿï¼‰

**åœ¨ `Skybox.h` ä¸­æ·»åŠ ï¼š**
```cpp
class Skybox {
public:
    // ... ç°æœ‰æ–¹æ³• ...

    // æ–°å¢ï¼šè¿”å›ç«‹æ–¹ä½“è´´å›¾çº¹ç†ID
    unsigned int GetTextureID() const { return textureID; }

private:
    unsigned int textureID;  // ç¡®ä¿æœ‰è¿™ä¸ªæˆå‘˜
};
```

### Step 5: é›†æˆåˆ° main.cppï¼ˆ30åˆ†é’Ÿï¼‰

```cpp
// 1. åŒ…å«å¤´æ–‡ä»¶
#include "WaterPlane.h"

// 2. åˆå§‹åŒ–æ°´é¢
WaterPlane waterPlane(0.0f, 1000.0f, 100);  // æ°´é¢é«˜åº¦0ï¼Œå¤§å°1000x1000ï¼Œåˆ†è¾¨ç‡100
Shader waterShader("Shaders/waterVertex.glsl", "Shaders/waterFragment.glsl");

// 3. æ¸²æŸ“å¾ªç¯ä¸­æ·»åŠ 
// ... æ¸²æŸ“åœ°å½¢ ...

// æ¸²æŸ“æ°´é¢
glEnable(GL_BLEND);
glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);

waterShader.Use();
waterShader.SetMat4("model", glm::mat4(1.0f));
waterShader.SetMat4("view", camera.GetViewMatrix());
waterShader.SetMat4("projection", projection);
waterShader.SetVec3("viewPos", camera.Position);
waterShader.SetFloat("time", glfwGetTime());
waterShader.SetVec3("waterColor", glm::vec3(0.1f, 0.3f, 0.5f));

// ç»‘å®šå¤©ç©ºç›’çº¹ç†
glActiveTexture(GL_TEXTURE0);
glBindTexture(GL_TEXTURE_CUBE_MAP, skybox.GetTextureID());
waterShader.SetInt("skybox", 0);

waterPlane.Render(waterShader);

glDisable(GL_BLEND);

// ... æ¸²æŸ“å¤©ç©ºç›’ ...
```

### Step 6: æµ‹è¯•å’Œè°ƒä¼˜ï¼ˆ1-2å°æ—¶ï¼‰

**è°ƒè¯•æ£€æŸ¥æ¸…å•ï¼š**
- [ ] æ°´é¢ä½ç½®æ˜¯å¦æ­£ç¡®ï¼ˆY = 0ï¼‰
- [ ] åœ°å½¢æ˜¯å¦éƒ¨åˆ†åœ¨æ°´é¢ä¸‹
- [ ] æ°´é¢æ˜¯å¦åŠé€æ˜
- [ ] åå°„æ•ˆæœæ˜¯å¦å¯è§
- [ ] æ³¢æµªåŠ¨ç”»æ˜¯å¦æµç•…
- [ ] ä¸åŒè§’åº¦è§‚å¯Ÿæ•ˆæœ

**å¸¸è§å‚æ•°è°ƒæ•´ï¼š**
```cpp
// æ°´é¢é¢œè‰²
waterColor = vec3(0.05, 0.2, 0.4);  // æ·±æµ·è“
waterColor = vec3(0.1, 0.4, 0.6);   // æµ…æµ·è“
waterColor = vec3(0.0, 0.5, 0.5);   // é’ç»¿è‰²

// é€æ˜åº¦
alpha = 0.6;  // æ›´é€æ˜
alpha = 0.8;  // æ›´ä¸é€æ˜

// æ³¢æµªå¹…åº¦
pos.y += sin(...) * 0.1;  // å¹³é™æ°´é¢
pos.y += sin(...) * 0.5;  // æ³¢æ¶›æ±¹æ¶Œ
```

---

## ğŸ“¦ æ‰€éœ€èµ„æº

### çº¹ç†èµ„æºï¼ˆå¯é€‰ï¼‰
1. **æ°´æ³•çº¿è´´å›¾** - ç”¨äºæ›´çœŸå®çš„æ³¢æµª
   - æœç´¢ï¼š"water normal map"
   - æ¨èç½‘ç«™ï¼š[Poly Haven](https://polyhaven.com/textures?c=water)

2. **DuDv è´´å›¾** - ç”¨äºæ‰­æ›²æ•ˆæœï¼ˆæ–¹æ¡ˆ3ï¼‰
   - æœç´¢ï¼š"water dudv map"
   - [LearnOpenGL æ•™ç¨‹](https://learnopengl.com/)æœ‰æä¾›

### ä¸éœ€è¦é¢å¤–èµ„æº
- âœ… å¤©ç©ºç›’å·²æœ‰ï¼ˆç”¨äºåå°„ï¼‰
- âœ… ç€è‰²å™¨ä»£ç æœ¬æ–‡æ¡£æä¾›
- âœ… åŸºç¡€æ°´é¢ä¸éœ€è¦çº¹ç†

---

## â±ï¸ æ—¶é—´ä¼°ç®—

### æ–¹æ¡ˆ2ï¼ˆæ¨èï¼‰è¯¦ç»†æ—¶é—´ï¼š
| ä»»åŠ¡ | é¢„è®¡æ—¶é—´ | è¯´æ˜ |
|------|----------|------|
| è°ƒæ•´åœ°å½¢é«˜åº¦ | 15åˆ†é’Ÿ | ä¿®æ”¹å‡ è¡Œä»£ç  |
| åˆ›å»º WaterPlane ç±» | 1å°æ—¶ | ç½‘æ ¼ç”Ÿæˆé€»è¾‘ |
| ç¼–å†™æ°´é¢ç€è‰²å™¨ | 30åˆ†é’Ÿ | å¤åˆ¶ç²˜è´´ + è°ƒæ•´ |
| ä¿®æ”¹ Skybox ç±» | 15åˆ†é’Ÿ | æ·»åŠ  getter |
| é›†æˆåˆ° main.cpp | 30åˆ†é’Ÿ | æ¸²æŸ“æµç¨‹ |
| æµ‹è¯•å’Œè°ƒä¼˜ | 1-2å°æ—¶ | å‚æ•°è°ƒæ•´ |
| **æ€»è®¡** | **4-5å°æ—¶ï¼ˆçº¦åŠå¤©åˆ°1å¤©ï¼‰** | |

---

## ğŸ¯ æˆåŠŸæ ‡å‡†

å®Œæˆååº”è¯¥è¾¾åˆ°çš„æ•ˆæœï¼š

### è§†è§‰æ•ˆæœ
- [x] åœ°å½¢æœ‰å²›å±¿éœ²å‡ºæ°´é¢
- [x] åœ°å½¢æœ‰éƒ¨åˆ†åœ¨æ°´é¢ä¸‹ï¼ˆæµ·åº•ï¼‰
- [x] æ°´é¢å‘ˆç°è“è‰²åŠé€æ˜
- [x] æ°´é¢æœ‰åŠ¨æ€æ³¢æµª
- [x] æ°´é¢åå°„å¤©ç©ºç›’ï¼ˆæµ·æ´‹ï¼‰
- [x] ä»ä¸åŒè§’åº¦çœ‹æ•ˆæœè‡ªç„¶

### æŠ€æœ¯æŒ‡æ ‡
- [x] æ»¡è¶³"ç¯å¢ƒæ˜ å°„"è¯¾ç¨‹è¦æ±‚
- [x] å¸§ç‡ç¨³å®šï¼ˆ>30 FPSï¼‰
- [x] æ— æ˜æ˜¾æ¸²æŸ“é”™è¯¯
- [x] ä»£ç æœ‰è¯¦ç»†æ³¨é‡Š

---

## ğŸ” å¸¸è§é—®é¢˜æ’æŸ¥

### Q1: æ°´é¢ä¸é€æ˜ï¼Ÿ
```cpp
// ç¡®ä¿å¯ç”¨äº†æ··åˆ
glEnable(GL_BLEND);
glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);

// ç€è‰²å™¨è¾“å‡º alpha < 1.0
FragColor = vec4(color, 0.7);
```

### Q2: çœ‹ä¸åˆ°åå°„ï¼Ÿ
```cpp
// æ£€æŸ¥å¤©ç©ºç›’çº¹ç†æ˜¯å¦æ­£ç¡®ç»‘å®š
glActiveTexture(GL_TEXTURE0);
glBindTexture(GL_TEXTURE_CUBE_MAP, skyboxTextureID);

// æ£€æŸ¥é‡‡æ ·å™¨ uniform
waterShader.SetInt("skybox", 0);
```

### Q3: æ³¢æµªä¸åŠ¨ï¼Ÿ
```cpp
// ç¡®ä¿ä¼ å…¥æ—¶é—´ uniform
waterShader.SetFloat("time", glfwGetTime());
```

### Q4: æ°´é¢é—ªçƒï¼Ÿ
```cpp
// Z-fighting é—®é¢˜ï¼Œè°ƒæ•´æ°´é¢é«˜åº¦
waterLevel = 0.05f;  // ç¨å¾®é«˜ä¸€ç‚¹
// æˆ–å¯ç”¨å¤šè¾¹å½¢åç§»
glEnable(GL_POLYGON_OFFSET_FILL);
glPolygonOffset(-1.0f, -1.0f);
```

---

## ğŸ“š å‚è€ƒèµ„æ–™

### æ¨èæ•™ç¨‹
1. **LearnOpenGL - Cubemaps**
   - https://learnopengl.com/Advanced-OpenGL/Cubemaps
   - ç¯å¢ƒæ˜ å°„åŸç†

2. **LearnOpenGL - Framebuffers**
   - https://learnopengl.com/Advanced-OpenGL/Framebuffers
   - åå°„æŠ˜å°„å®ç°ï¼ˆæ–¹æ¡ˆ3ï¼‰

3. **ThinMatrix Water Tutorial**
   - YouTube: "OpenGL Water Tutorial"
   - å®Œæ•´çš„æ°´é¢æ¸²æŸ“æ•™ç¨‹

### ä»£ç å‚è€ƒ
- æœ¬é¡¹ç›®ç°æœ‰ç³»ç»Ÿï¼š
  - `Terrain.cpp` - ç½‘æ ¼ç”Ÿæˆå‚è€ƒ
  - `Skybox.cpp` - ç«‹æ–¹ä½“è´´å›¾ä½¿ç”¨
  - `Shader.cpp` - ç€è‰²å™¨ç³»ç»Ÿ

---

## ğŸš€ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³å¼€å§‹ï¼ˆæ¨èé¡ºåºï¼‰ï¼š

1. **å…ˆå¿«é€Ÿæµ‹è¯•**ï¼ˆ15åˆ†é’Ÿï¼‰
   ```cpp
   // åœ¨ Terrain.cpp ä¸­è°ƒæ•´é«˜åº¦
   float height = pixelValue * 20.0f - 8.0f;
   ```
   è¿è¡Œç¨‹åºï¼Œçœ‹åœ°å½¢æ˜¯å¦æœ‰èµ·ä¼

2. **åˆ›å»ºåŸºç¡€æ°´é¢**ï¼ˆ1å°æ—¶ï¼‰
   - åˆ›å»º WaterPlane ç±»
   - å®ç°ç®€å•è“è‰²å¹³é¢
   - æµ‹è¯•æ¸²æŸ“

3. **æ·»åŠ åå°„æ•ˆæœ**ï¼ˆ2å°æ—¶ï¼‰
   - ç¼–å†™åå°„ç€è‰²å™¨
   - é›†æˆå¤©ç©ºç›’çº¹ç†
   - è°ƒè¯•æ•ˆæœ

4. **ä¼˜åŒ–å’Œå®Œå–„**ï¼ˆ1-2å°æ—¶ï¼‰
   - æ·»åŠ æ³¢æµªåŠ¨ç”»
   - è°ƒæ•´é¢œè‰²å’Œé€æ˜åº¦
   - æµ‹è¯•ä¸åŒè§†è§’

---

## ğŸ’¡ å®æ–½å»ºè®®

### ä¼˜å…ˆçº§é¡ºåº
1. â­â­â­ **å…ˆè§£å†³æ‚¬æµ®é—®é¢˜**ï¼ˆè°ƒæ•´åœ°å½¢é«˜åº¦ï¼‰
2. â­â­â­ **å¿«é€Ÿæ·»åŠ åŸºç¡€æ°´é¢**ï¼ˆæ–¹æ¡ˆ1ï¼‰
3. â­â­ **å‡çº§åˆ°åå°„æ°´é¢**ï¼ˆæ–¹æ¡ˆ2ï¼‰- æ»¡è¶³è¯¾ç¨‹è¦æ±‚
4. â­ **å¦‚æ—¶é—´å……è¶³å†è€ƒè™‘æ–¹æ¡ˆ3**

### é£é™©æ§åˆ¶
- æ¯å®Œæˆä¸€æ­¥å°±ä¿å­˜ä»£ç ï¼ˆGit commitï¼‰
- é‡åˆ°é—®é¢˜å…ˆå›é€€åˆ°ä¸Šä¸€ä¸ªå·¥ä½œç‰ˆæœ¬
- ä¸è¦ä¸€æ¬¡æ€§å†™å®Œæ‰€æœ‰ä»£ç ï¼Œé€æ­¥æµ‹è¯•

### è¯¾ç¨‹è¦æ±‚åŒ¹é…
- âœ… **ç¯å¢ƒæ˜ å°„æ¼”ç¤º** - æ–¹æ¡ˆ2å³å¯æ»¡è¶³
- âœ… **çº¹ç†æ˜ å°„** - æ°´é¢ä½¿ç”¨å¤©ç©ºç›’çº¹ç†
- âœ… **è§†è§‰æ•ˆæœ** - åŠ¨æ€æ³¢æµª + åå°„

---

## ğŸ‰ é¢„æœŸæ•ˆæœ

å®Œæˆåä½ å°†æ‹¥æœ‰ï¼š
- ğŸŒŠ ä¸€ä¸ªæ¼‚äº®çš„æµ·æ´‹åœºæ™¯
- ğŸï¸ å²›å±¿åœ°å½¢ï¼ˆéƒ¨åˆ†éœ²å‡ºæ°´é¢ï¼‰
- ğŸ’§ çœŸå®çš„åå°„æ°´é¢
- ğŸŒ… æ°´é¢åå°„æµ·æ´‹å¤©ç©ºç›’
- âœ… æ»¡è¶³"ç¯å¢ƒæ˜ å°„"è¯¾ç¨‹è¦æ±‚

---

**å‡†å¤‡å¥½å¼€å§‹äº†å—ï¼Ÿå‘Šè¯‰æˆ‘ä½ æƒ³ä»å“ªé‡Œå¼€å§‹ï¼Œæˆ‘ä¼šç«‹å³å¸®ä½ å®ç°ï¼** ğŸš€
