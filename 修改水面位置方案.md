# ä¿®æ”¹æ°´é¢ä½ç½®çš„ä¸¤ç§æ–¹æ¡ˆ

## å½“å‰å®ç°åˆ†æ

### ä½ç½®æ§åˆ¶ä»£ç ä½ç½®ï¼š
**`WaterPlane.cpp:80-98`**

```cpp
// ç¬¬80-82è¡Œï¼šæ§åˆ¶æ°´é¢ä¸­å¿ƒä½ç½®
float startX = -m_Size / 2.0f;  // â† è®©æ°´é¢ä¸­å¿ƒåœ¨X=0
float startZ = -m_Size / 2.0f;  // â† è®©æ°´é¢ä¸­å¿ƒåœ¨Z=0

// ç¬¬96-98è¡Œï¼šè®¡ç®—æ¯ä¸ªé¡¶ç‚¹ä½ç½®
float posX = startX + x * cellSize;  // Xåæ ‡
float posY = m_WaterLevel;           // Yåæ ‡ï¼ˆç”±æ„é€ å‡½æ•°å‚æ•°æ§åˆ¶ï¼‰
float posZ = startZ + z * cellSize;  // Zåæ ‡
```

### å½“å‰ä½ç½®è®¡ç®—ç»“æœ

å¯¹äº `WaterPlane water(2.0f, 50.0f, 100);`ï¼š
- **æ°´é¢é«˜åº¦ï¼ˆYï¼‰**ï¼š2.0
- **æ°´é¢å¤§å°**ï¼š50Ã—50
- **æ°´é¢ä¸­å¿ƒ**ï¼š**(0, 2.0, 0)** â† å›ºå®šåœ¨åŸç‚¹ä¸Šæ–¹
- **XèŒƒå›´**ï¼š-25.0 åˆ° +25.0
- **ZèŒƒå›´**ï¼š-25.0 åˆ° +25.0

---

## âœ… æ–¹æ³•1ï¼šä¿®æ”¹WaterPlaneç±»ï¼ˆæœ€ä½³æ–¹æ¡ˆï¼‰

**ä¼˜ç‚¹ï¼š**
- âœ… ç›´æ¥åœ¨é¡¶ç‚¹ç”Ÿæˆæ—¶è®¾ç½®ä½ç½®ï¼Œæ€§èƒ½æœ€ä¼˜
- âœ… ä»£ç æ¸…æ™°ï¼Œå‚æ•°ç›´è§‚
- âœ… é€‚åˆå›ºå®šä½ç½®çš„æ°´é¢

### å®ç°æ­¥éª¤

#### 1ï¸âƒ£ ä¿®æ”¹ `WaterPlane.h` - æ·»åŠ ä¸­å¿ƒåæ ‡å‚æ•°

åœ¨æ„é€ å‡½æ•°ä¸­æ·»åŠ centerXå’ŒcenterZå‚æ•°ï¼š

```cpp
// åŸæ¥çš„æ„é€ å‡½æ•°ï¼ˆç¬¬36è¡Œï¼‰ï¼š
WaterPlane(float waterLevel, float size, int resolution);

// ä¿®æ”¹ä¸ºï¼š
WaterPlane(float waterLevel, float size, int resolution,
           float centerX = 0.0f, float centerZ = 0.0f);
//         â†‘ æ·»åŠ ä¸¤ä¸ªå‚æ•°ï¼Œé»˜è®¤å€¼ä¸º0ï¼ˆä¿æŒå‘åå…¼å®¹ï¼‰
```

#### 2ï¸âƒ£ ä¿®æ”¹ `WaterPlane.h` - æ·»åŠ æˆå‘˜å˜é‡

åœ¨privateéƒ¨åˆ†ï¼ˆçº¦ç¬¬67-71è¡Œï¼‰æ·»åŠ æˆå‘˜å˜é‡ï¼š

```cpp
private:
    // OpenGLå¯¹è±¡
    unsigned int m_VAO;
    unsigned int m_VBO;
    unsigned int m_EBO;

    // æ°´é¢å‚æ•°
    float m_WaterLevel;
    float m_Size;
    int m_Resolution;
    unsigned int m_IndexCount;

    // æ–°å¢ï¼šæ°´é¢ä¸­å¿ƒåæ ‡
    float m_CenterX;  // â† æ·»åŠ è¿™è¡Œ
    float m_CenterZ;  // â† æ·»åŠ è¿™è¡Œ
```

#### 3ï¸âƒ£ ä¿®æ”¹ `WaterPlane.cpp` - æ„é€ å‡½æ•°

åœ¨æ„é€ å‡½æ•°ä¸­æ¥æ”¶å¹¶ä¿å­˜å‚æ•°ï¼ˆç¬¬8-16è¡Œï¼‰ï¼š

```cpp
// åŸæ¥çš„æ„é€ å‡½æ•°ï¼š
WaterPlane::WaterPlane(float waterLevel, float size, int resolution)
    : m_VAO(0)
    , m_VBO(0)
    , m_EBO(0)
    , m_WaterLevel(waterLevel)
    , m_Size(size)
    , m_Resolution(resolution)
    , m_IndexCount(0)

// ä¿®æ”¹ä¸ºï¼š
WaterPlane::WaterPlane(float waterLevel, float size, int resolution,
                       float centerX, float centerZ)
    : m_VAO(0)
    , m_VBO(0)
    , m_EBO(0)
    , m_WaterLevel(waterLevel)
    , m_Size(size)
    , m_Resolution(resolution)
    , m_IndexCount(0)
    , m_CenterX(centerX)     // â† æ·»åŠ 
    , m_CenterZ(centerZ)     // â† æ·»åŠ 
```

#### 4ï¸âƒ£ ä¿®æ”¹ `WaterPlane.cpp` - GenerateMeshå‡½æ•°

ä¿®æ”¹èµ·å§‹ä½ç½®è®¡ç®—ï¼ˆç¬¬80-82è¡Œï¼‰ï¼š

```cpp
// åŸæ¥çš„ä»£ç ï¼š
float startX = -m_Size / 2.0f;
float startZ = -m_Size / 2.0f;

// ä¿®æ”¹ä¸ºï¼š
float startX = m_CenterX - m_Size / 2.0f;  // â† ç›¸å¯¹äºä¸­å¿ƒç‚¹åç§»
float startZ = m_CenterZ - m_Size / 2.0f;  // â† ç›¸å¯¹äºä¸­å¿ƒç‚¹åç§»
```

#### 5ï¸âƒ£ åœ¨main.cppä¸­ä½¿ç”¨æ–°å‚æ•°

```cpp
// åŸæ¥çš„è°ƒç”¨ï¼š
WaterPlane water(2.0f, 50.0f, 100);

// æ–°çš„è°ƒç”¨æ–¹å¼ï¼š
// 1. ä½¿ç”¨é»˜è®¤ä¸­å¿ƒä½ç½®ï¼ˆ0, 0ï¼‰- å‘åå…¼å®¹
WaterPlane water(2.0f, 50.0f, 100);

// 2. æŒ‡å®šæ°´é¢ä¸­å¿ƒä½ç½®
WaterPlane water(2.0f, 50.0f, 100, 50.0f, 50.0f);
//                                  â†‘      â†‘
//                                centerX centerZ
//               æ°´é¢ä¸­å¿ƒå°†åœ¨ä¸–ç•Œåæ ‡ (50, 2.0, 50)

// 3. ç¤ºä¾‹ï¼šå¦‚æœåœ°å½¢æ˜¯100Ã—100ï¼Œä¸­å¿ƒåœ¨(50, ?, 50)
//    è®©æ°´é¢ä¹Ÿåœ¨åœ°å½¢ä¸­å¿ƒï¼š
WaterPlane water(2.0f, 40.0f, 100, 50.0f, 50.0f);
```

---

## âœ… æ–¹æ³•2ï¼šä½¿ç”¨ModelçŸ©é˜µå¹³ç§»ï¼ˆæ›´çµæ´»ï¼‰

**ä¼˜ç‚¹ï¼š**
- âœ… ä¸éœ€è¦ä¿®æ”¹WaterPlaneç±»
- âœ… å¯ä»¥è¿è¡Œæ—¶åŠ¨æ€ç§»åŠ¨æ°´é¢
- âœ… å¯ä»¥ç»“åˆæ—‹è½¬ã€ç¼©æ”¾ç­‰å˜æ¢

**ç¼ºç‚¹ï¼š**
- âŒ éœ€è¦åœ¨ç€è‰²å™¨ä¸­è¿›è¡ŒçŸ©é˜µè¿ç®—ï¼ˆæ€§èƒ½ç•¥å·®ï¼Œä½†å½±å“å¯å¿½ç•¥ï¼‰

### å®ç°æ­¥éª¤

#### åœ¨main.cppçš„æ¸²æŸ“å¾ªç¯ä¸­ä¿®æ”¹modelçŸ©é˜µ

æ‰¾åˆ°æ°´é¢æ¸²æŸ“ä»£ç ï¼ˆçº¦350-400è¡Œï¼‰ï¼Œä¿®æ”¹ï¼š

```cpp
// åŸæ¥çš„ä»£ç ï¼š
waterShader.Use();
waterShader.SetMat4("model", glm::mat4(1.0f));  // â† å•ä½çŸ©é˜µï¼Œæ— å˜æ¢
water.Render();

// ä¿®æ”¹ä¸ºï¼š
waterShader.Use();

// åˆ›å»ºå¹³ç§»çŸ©é˜µï¼Œå°†æ°´é¢ç§»åŠ¨åˆ° (50, 0, 50)
glm::mat4 waterModel = glm::mat4(1.0f);
waterModel = glm::translate(waterModel, glm::vec3(50.0f, 0.0f, 50.0f));
//                                                  â†‘      â†‘     â†‘
//                                               Xåç§»  Yåç§»  Zåç§»
// æ³¨æ„ï¼šYåç§»é€šå¸¸è®¾ä¸º0ï¼Œå› ä¸ºæ°´é¢é«˜åº¦å·²ç»ç”±æ„é€ å‡½æ•°å‚æ•°æ§åˆ¶

waterShader.SetMat4("model", waterModel);
water.Render();
```

### åŠ¨æ€ç§»åŠ¨æ°´é¢ç¤ºä¾‹

```cpp
// è®©æ°´é¢éšæ—¶é—´ç§»åŠ¨ï¼ˆåŠ¨æ€æ•ˆæœï¼‰
float time = glfwGetTime();
float offsetX = sin(time) * 10.0f;  // Xæ–¹å‘æ¥å›æ‘†åŠ¨
float offsetZ = cos(time) * 10.0f;  // Zæ–¹å‘æ¥å›æ‘†åŠ¨

glm::mat4 waterModel = glm::mat4(1.0f);
waterModel = glm::translate(waterModel, glm::vec3(50.0f + offsetX, 0.0f, 50.0f + offsetZ));
waterShader.SetMat4("model", waterModel);
water.Render();
```

---

## ğŸ¯ ä¸¤ç§æ–¹æ³•å¯¹æ¯”

| ç‰¹æ€§ | æ–¹æ³•1ï¼šä¿®æ”¹ç±» | æ–¹æ³•2ï¼šModelçŸ©é˜µ |
|------|--------------|-----------------|
| **æ€§èƒ½** | â­â­â­â­â­ï¼ˆæœ€ä¼˜ï¼‰ | â­â­â­â­ï¼ˆç•¥æ…¢ï¼‰ |
| **å®ç°éš¾åº¦** | ä¸­ç­‰ï¼ˆéœ€ä¿®æ”¹ç±»ï¼‰ | ç®€å•ï¼ˆåªæ”¹main.cppï¼‰ |
| **ä»£ç æ¸…æ™°åº¦** | â­â­â­â­â­ | â­â­â­â­ |
| **çµæ´»æ€§** | å›ºå®šä½ç½® | å¯åŠ¨æ€ç§»åŠ¨ |
| **æ¨èåœºæ™¯** | å›ºå®šä½ç½®çš„æ°´é¢ | éœ€è¦ç§»åŠ¨çš„æ°´é¢ |

---

## ğŸ”§ å®æˆ˜ç¤ºä¾‹

### åœºæ™¯ï¼šåœ°å½¢æ˜¯100Ã—100ï¼Œä¸­å¿ƒåœ¨(50, ?, 50)ï¼Œæƒ³åœ¨åœ°å½¢ä¸­å¿ƒæ”¾ä¸€ä¸ªæ°´å‘

#### æ–¹æ¡ˆAï¼šä½¿ç”¨æ–¹æ³•1ï¼ˆæ¨èï¼‰

```cpp
// 1. ä¿®æ”¹WaterPlaneç±»ï¼ˆæŒ‰ç…§ä¸Šé¢çš„æ­¥éª¤ï¼‰

// 2. åœ¨main.cppä¸­ï¼š
Terrain terrain("Textures/heightmap.png", 100.0f, 10.0f);

// æ°´é¢å‚æ•°ï¼š
//   é«˜åº¦ï¼š2.0ï¼ˆå‘åº•ç•¥ä¸Šæ–¹ï¼‰
//   å¤§å°ï¼š40Ã—40ï¼ˆå°äºå‘çš„ç›´å¾„ï¼‰
//   åˆ†è¾¨ç‡ï¼š100
//   ä¸­å¿ƒXï¼š50.0ï¼ˆåœ°å½¢ä¸­å¿ƒï¼‰
//   ä¸­å¿ƒZï¼š50.0ï¼ˆåœ°å½¢ä¸­å¿ƒï¼‰
WaterPlane water(2.0f, 40.0f, 100, 50.0f, 50.0f);
```

#### æ–¹æ¡ˆBï¼šä½¿ç”¨æ–¹æ³•2ï¼ˆæ— éœ€ä¿®æ”¹ç±»ï¼‰

```cpp
// 1. åœ¨main.cppä¸­ï¼š
Terrain terrain("Textures/heightmap.png", 100.0f, 10.0f);

// æ°´é¢é»˜è®¤ä¸­å¿ƒåœ¨(0, 2.0, 0)
WaterPlane water(2.0f, 40.0f, 100);

// 2. åœ¨æ¸²æŸ“å¾ªç¯ä¸­ï¼š
waterShader.Use();
waterShader.SetFloat("time", glfwGetTime());
waterShader.SetVec3("viewPos", camera.Position);

// ä½¿ç”¨modelçŸ©é˜µå°†æ°´é¢å¹³ç§»åˆ°åœ°å½¢ä¸­å¿ƒ
glm::mat4 waterModel = glm::mat4(1.0f);
waterModel = glm::translate(waterModel, glm::vec3(50.0f, 0.0f, 50.0f));
waterShader.SetMat4("model", waterModel);
waterShader.SetMat4("view", camera.GetViewMatrix());
waterShader.SetMat4("projection", projection);

// ç»‘å®šå¤©ç©ºç›’çº¹ç†
glActiveTexture(GL_TEXTURE0);
glBindTexture(GL_TEXTURE_CUBE_MAP, skyboxCubemapTexture);
waterShader.SetInt("skybox", 0);

water.Render();
```

---

## ğŸ“Š åœ°å½¢å’Œæ°´é¢åæ ‡å…³ç³»

### Terrainçš„åæ ‡ç³»ç»Ÿ

æŸ¥çœ‹ `Terrain.cpp:172-173`ï¼š
```cpp
float cellSizeX = m_TerrainSize / (m_Width - 1);
float cellSizeZ = m_TerrainSize / (m_Height - 1);
```

å’Œ `Terrain.cpp:189-198`ï¼š
```cpp
float posX = x * cellSizeX;  // Xåæ ‡ä»0å¼€å§‹
// ...
float posZ = z * cellSizeZ;  // Zåæ ‡ä»0å¼€å§‹
```

**åœ°å½¢åæ ‡èŒƒå›´**ï¼ˆå‡è®¾terrainSize=100ï¼‰ï¼š
- X: **0 åˆ° 100**
- Z: **0 åˆ° 100**
- åœ°å½¢ä¸­å¿ƒ: **(50, ?, 50)**

**æ°´é¢é»˜è®¤åæ ‡èŒƒå›´**ï¼ˆsize=50ï¼‰ï¼š
- X: **-25 åˆ° +25**
- Z: **-25 åˆ° +25**
- æ°´é¢ä¸­å¿ƒ: **(0, ?, 0)**

**é—®é¢˜ï¼š** æ°´é¢å’Œåœ°å½¢ä¸­å¿ƒä¸å¯¹é½ï¼

**è§£å†³æ–¹æ¡ˆï¼š** å°†æ°´é¢ç§»åŠ¨åˆ° (50, Y, 50)ï¼Œä½¿ç”¨ä¸Šè¿°ä»»ä¸€æ–¹æ³•ã€‚

---

## âœ… å¿«é€Ÿè§£å†³æ–¹æ¡ˆï¼ˆæ¨èæ–¹æ³•2ï¼‰

å¦‚æœä½ åªæ˜¯æƒ³å¿«é€Ÿçœ‹åˆ°æ•ˆæœï¼Œ**ä¸æƒ³ä¿®æ”¹WaterPlaneç±»**ï¼Œåªéœ€åœ¨main.cppä¸­æ‰¾åˆ°æ°´é¢æ¸²æŸ“ä»£ç ï¼Œæ·»åŠ ä¸€è¡Œï¼š

```cpp
// æ¸²æŸ“æ°´é¢
waterShader.Use();
// ... è®¾ç½®å…¶ä»–uniform ...

// â­ æ·»åŠ è¿™è¡Œï¼šå°†æ°´é¢å¹³ç§»åˆ°åœ°å½¢ä¸­å¿ƒ
glm::mat4 waterModel = glm::translate(glm::mat4(1.0f), glm::vec3(50.0f, 0.0f, 50.0f));
waterShader.SetMat4("model", waterModel);

water.Render();
```

**å°±è¿™ä¹ˆç®€å•ï¼æ°´é¢ç°åœ¨ä¼šå‡ºç°åœ¨åœ°å½¢ä¸­å¿ƒ (50, 2.0, 50) ä½ç½®ã€‚**

---

## ğŸ› è°ƒè¯•æŠ€å·§

### å¦‚ä½•ç¡®è®¤æ°´é¢ä½ç½®

åœ¨main.cppä¸­æ·»åŠ è°ƒè¯•è¾“å‡ºï¼š

```cpp
std::cout << "åœ°å½¢ä¸­å¿ƒ: (" << 100.0f / 2.0f << ", ?, " << 100.0f / 2.0f << ")" << std::endl;
std::cout << "æ°´é¢ä¸­å¿ƒ: (50.0, " << water.GetWaterLevel() << ", 50.0)" << std::endl;
```

### å¯è§†åŒ–è¾…åŠ©

åœ¨æ°´é¢ä¸­å¿ƒä½ç½®æ¸²æŸ“ä¸€ä¸ªå°çƒä½“æˆ–ç«‹æ–¹ä½“ï¼Œç¡®è®¤ä½ç½®æ­£ç¡®ã€‚

---

## ğŸ“š æ€»ç»“

**æ§åˆ¶æ°´é¢ä½ç½®çš„å…³é”®ä»£ç ä½ç½®ï¼š**
- **`WaterPlane.cpp:80-82`** - è®¡ç®—startXå’ŒstartZ
- **`WaterPlane.cpp:96-98`** - è®¾ç½®æ¯ä¸ªé¡¶ç‚¹çš„ä½ç½®

**æ¨èæ–¹æ¡ˆï¼š**
- ğŸ† **ä¸´æ—¶æµ‹è¯•**ï¼šä½¿ç”¨æ–¹æ³•2ï¼ˆModelçŸ©é˜µå¹³ç§»ï¼‰
- ğŸ† **æ­£å¼é¡¹ç›®**ï¼šä½¿ç”¨æ–¹æ³•1ï¼ˆä¿®æ”¹WaterPlaneç±»ï¼‰

**ä¸‹ä¸€æ­¥ï¼š**
1. å†³å®šä½¿ç”¨å“ªç§æ–¹æ³•
2. æŒ‰ç…§ä¸Šé¢çš„æ­¥éª¤å®ç°
3. ç¼–è¯‘è¿è¡Œï¼Œè°ƒæ•´å‚æ•°
4. äº«å—æ°´é¢åœ¨åœ°å½¢å‘ä¸­çš„å®Œç¾åå°„æ•ˆæœï¼ğŸŒŠ
