# 镜面反射测试指南

## ✅ 已完成的修改

在 `terrainFragment.glsl` 中添加了镜面反射计算：

```glsl
// 新增代码（约30行）
float specularStrength = 0.2;
vec3 viewDir = normalize(viewPos - FragPos);
vec3 reflectDir = reflect(-lightDir, norm);
float spec = pow(max(dot(viewDir, reflectDir), 0.0), 32);
vec3 specular = specularStrength * spec * lightColor;

// 修改光照组合
vec3 lighting = ambient + diffuse + specular;  // 加上了specular
```

---

## 🚀 测试步骤

### 第1步：编译运行（5分钟）

1. **在 Visual Studio 中打开项目**
   - 双击 `8502_CrouseWork.sln`

2. **编译项目**
   - 按 `F5` 或 `Ctrl+Shift+B`
   - 等待编译完成

3. **运行程序**
   - 如果编译成功，程序会自动运行
   - 观察地形渲染

---

### 第2步：寻找镜面反射效果（5-10分钟）

镜面反射在地形上**可能比较微弱**，需要调整视角才能看到。

#### 如何找到高光位置

**方法1：移动到高处俯视**
```
1. 按住 Space（上升）到地形上方
2. 向下看地形
3. 缓慢移动鼠标，旋转视角
4. 注意观察地形的山坡上是否有亮点
```

**方法2：在地形上低飞**
```
1. 飞到地形高度附近（y = 10-20）
2. 以较低的角度观察地形
3. 寻找倾斜的山坡
4. 高光通常出现在朝向光源的斜面上
```

**方法3：调整光源位置**（临时测试）
```cpp
// 在 main.cpp 中修改光源位置，临时测试
glm::vec3 lightPos(50.0f, 100.0f, 50.0f);  // 提高高度，更接近垂直

// 或者提高光照强度
glm::vec3 lightColor(2.0f, 2.0f, 1.8f);  // 增强亮度
```

---

### 第3步：观察效果对比

#### 有镜面反射（当前）vs 无镜面反射（之前）

**之前（只有环境光+漫反射）**：
- 地形有明暗对比
- 但缺乏高光，看起来较平淡
- 表面粗糙、哑光

**现在（完整Phong模型）**：
- 地形仍有明暗对比
- 某些角度能看到**淡淡的亮点/高光**
- 表面略有光泽（像湿润的地面）

#### 预期效果

在地形上的镜面反射应该是：
- ✅ **微弱的**（因为 specularStrength = 0.2）
- ✅ **分散的**（因为 shininess = 32）
- ✅ **只在特定角度可见**（需要视角、表面、光源对齐）
- ✅ **出现在山坡和倾斜面上**（不是平地）

**重要提示**：
> 草地地形的镜面反射本来就应该比较微弱！如果想看到明显的镜面反射效果，需要添加水面（我们下一步可以做）。

---

## 🔧 调试技巧

### 技巧1：只显示镜面反射分量

临时修改 `terrainFragment.glsl` 的输出：

```glsl
// 在 FragColor 之前添加（调试用）
FragColor = vec4(specular, 1.0);  // 只显示镜面反射
return;  // 提前返回，跳过正常输出
```

**效果**：
- 高光区域：白色/黄色
- 非高光区域：黑色
- 用于检查高光位置和范围

**记得调试完后删除这两行！**

---

### 技巧2：提高镜面反射强度（临时测试）

```glsl
// 临时修改参数，让高光更明显
float specularStrength = 0.8;  // 从 0.2 提高到 0.8
```

**效果**：
- 高光变得非常明显
- 容易找到高光位置
- 确认镜面反射确实在工作

**确认效果后，记得改回 0.2（符合草地特性）**

---

### 技巧3：降低光泽度，让高光更分散

```glsl
// 临时修改光泽度
float spec = pow(max(dot(viewDir, reflectDir), 0.0), 8);  // 从 32 降到 8
```

**效果**：
- 高光范围变大，更容易看到
- 但会显得很模糊

**确认效果后，记得改回 32**

---

## 📊 参数调整

### 当前参数（默认设置）

```glsl
specularStrength = 0.2   // 镜面反射强度
shininess = 32           // 光泽度
```

**适合**：草地、泥土等粗糙地形

---

### 调整建议

#### 场景1：想让地形看起来像"湿润的地面"
```glsl
float specularStrength = 0.3;  // 提高反射强度
float spec = pow(..., 64);      // 提高光泽度
```

#### 场景2：想让地形看起来像"干燥的泥土"
```glsl
float specularStrength = 0.1;  // 降低反射强度
float spec = pow(..., 16);      // 降低光泽度
```

#### 场景3：想让高光更明显（测试用）
```glsl
float specularStrength = 0.5;  // 大幅提高
float spec = pow(..., 16);      // 降低光泽度让高光更分散
```

---

## ✅ 验收标准

### 镜面反射实现成功的标志

- ✅ 程序能正常编译运行
- ✅ 地形渲染正常，没有黑屏或异常
- ✅ 在某些视角能看到淡淡的高光（即使很微弱）
- ✅ 高光位置随相机视角变化而移动
- ✅ 整体视觉效果比之前更真实

### 课程要求验收

| 要求 | 状态 |
|------|------|
| 至少一个光源 | ✅ |
| 环境光（Ambient） | ✅ |
| 漫反射（Diffuse） | ✅ |
| 镜面反射（Specular） | ✅ |

**结论**：完全满足课程光照要求！🎉

---

## 🐛 可能遇到的问题

### 问题1：完全看不到高光

**检查清单**：
1. ✅ 着色器是否成功编译？（看控制台）
2. ✅ `viewPos` uniform是否正确传入？（检查main.cpp）
3. ✅ 光源位置是否合理？
4. ✅ 是否调整了多个视角？（高光只在特定角度可见）

**解决方案**：
- 使用"调试技巧2"提高 specularStrength 到 0.8
- 如果仍然看不到，可能是视角问题，继续移动相机

---

### 问题2：编译错误

**常见错误**：
```
ERROR: 0:X: 'viewPos' : undeclared identifier
```

**原因**：`viewPos` 没有在着色器中声明

**解决**：检查 `terrainFragment.glsl` 顶部是否有：
```glsl
uniform vec3 viewPos;  // 相机位置
```

**这应该已经存在**（之前就有），如果没有请添加。

---

### 问题3：效果太弱，几乎看不见

**这是正常的！**

原因：
- 草地本来就是粗糙表面
- 我们设置的参数符合真实物理特性
- specularStrength = 0.2 是合理的

**选择**：
1. **保持现状**（推荐）：符合真实效果，满足课程要求
2. **提高参数**：修改为 0.3-0.5，让效果更明显
3. **添加水面**（最推荐）：水面的镜面反射会非常明显！

---

## 📸 截图建议

为了课程报告，建议截取以下对比图：

### 对比截图1：不同视角
- 截图1：能看到高光的角度
- 截图2：看不到高光的角度
- 说明：镜面反射取决于视角

### 对比截图2：参数对比（可选）
- 截图1：specularStrength = 0.1（弱）
- 截图2：specularStrength = 0.2（中）
- 截图3：specularStrength = 0.5（强）
- 说明：镜面反射强度的影响

---

## 🚀 下一步计划

### 完成镜面反射后

**选项1：调整参数优化效果**（30分钟）
- 尝试不同的 specularStrength 和 shininess
- 找到最满意的视觉效果
- 截图记录

**选项2：添加水面系统**（2-3小时）
- 创建平面水面
- 使用强镜面反射参数
- 看到明显的太阳反光
- 视觉效果震撼！

**选项3：继续其他功能**
- OBJ模型加载（树木、岩石）
- 场景图系统
- 自动相机路径

---

## 💡 期望管理

### 在地形上的镜面反射

**现实预期**：
- 效果微弱、需要特定角度才能看到
- 符合草地/泥土的物理特性
- ✅ 满足课程要求（完整Phong模型）

### 在水面上的镜面反射（下一步）

**预期效果**：
- 效果明显、容易观察
- 有明亮的太阳反光
- 视觉冲击力强
- ✅ 更好的演示效果

---

## 📝 总结

### 已完成
- ✅ 在着色器中添加镜面反射计算
- ✅ 实现完整的Phong光照模型
- ✅ 满足课程要求

### 当前状态
- 地形有微弱的镜面反射
- 需要调整视角观察
- 符合草地的真实特性

### 建议
- 先测试确认镜面反射工作正常
- 然后添加水面系统展示明显的镜面反射效果

---

**准备好了吗？编译运行，看看效果吧！** 🎉
