# 下一步实现计划 - 冬季/夏季森林场景

## 📊 当前进度总结

### ✅ 已完成（第1阶段）
1. ✅ 环境搭建（GLFW, GLAD, GLM, STB）
2. ✅ Window 窗口管理系统
3. ✅ Shader 着色器加载系统
4. ✅ Camera 第一人称相机系统
5. ✅ 基础渲染（彩色立方体）
6. ✅ 输入处理（WASD + 鼠标）

### 🎯 总体目标
创建一个可以在冬季和夏季场景之间切换的森林环境，包含：
- 地形系统
- 光照系统
- 天空盒
- 3D模型（树木、岩石）
- 时间转换效果

---

## 📅 实现计划（按优先级排序）

### 第2阶段：核心渲染功能（第1-2周）

#### 阶段目标
建立基础渲染系统，能够渲染带纹理和光照的地形。

---

### 📝 任务 1：纹理加载系统（1-2天）

**为什么先做这个？**
- 地形、模型、天空盒都需要纹理
- 是后续所有功能的基础

**实现内容：**

1. **创建 Texture 类** (`Texture.h/cpp`)
   - 使用 STB_image 加载图像
   - 支持 PNG, JPG 格式
   - 生成 OpenGL 纹理对象
   - 支持不同纹理参数（wrap mode, filter mode）

2. **功能特性：**
   - 2D 纹理加载
   - Mipmap 生成
   - 纹理绑定管理
   - 内存管理（析构函数释放纹理）

3. **测试方法：**
   - 在立方体上贴一张测试纹理
   - 验证纹理正确显示

**预计时间：** 1天

**需要的资源：**
- 测试纹理图片（任意 PNG/JPG）

---

### 📝 任务 2：地形生成系统（2-3天）

**为什么重要？**
- 地形是场景的主体
- 展示纹理、光照的最佳载体

**实现内容：**

1. **创建 Terrain 类** (`Terrain.h/cpp`)
   - 从高度图（灰度图像）生成地形网格
   - 计算顶点位置、法向量、纹理坐标
   - 生成 VAO/VBO/EBO

2. **技术细节：**
   - 高度图分辨率：建议 256x256 或 512x512
   - 像素亮度 → 高度值
   - 使用三角形条带渲染
   - 平滑法向量计算（用于光照）

3. **地形着色器：**
   - `terrainVertex.glsl` - 顶点变换
   - `terrainFragment.glsl` - 纹理采样

4. **测试方法：**
   - 渲染平坦地形
   - 加载高度图，查看起伏效果
   - 应用草地纹理

**预计时间：** 2-3天

**需要的资源：**
- 高度图图像（256x256 灰度图）
- 草地纹理（用于测试）

**难点：**
- 法向量计算（光照需要）
- 纹理坐标映射

---

### 📝 任务 3：冯氏光照模型（1-2天）

**为什么需要？**
- 让场景看起来真实
- 课程要求（必须有光照）

**实现内容：**

1. **光照着色器：**
   - 更新片段着色器，添加光照计算
   - 支持：环境光 + 漫反射 + 镜面反射

2. **光照公式：**
   ```glsl
   vec3 ambient  = Ka * lightColor;
   vec3 diffuse  = Kd * max(dot(normal, lightDir), 0.0) * lightColor;
   vec3 specular = Ks * pow(max(dot(viewDir, reflectDir), 0.0), shininess) * lightColor;

   vec3 result = ambient + diffuse + specular;
   ```

3. **Uniform 变量：**
   - 光源位置
   - 光源颜色
   - 相机位置
   - 材质参数（Ka, Kd, Ks, shininess）

4. **测试方法：**
   - 在地形上应用光照
   - 移动相机观察镜面高光变化
   - 调整光源位置

**预计时间：** 1-2天

**难点：**
- 法向量必须正确（地形生成时计算）
- Uniform 变量传递

---

### 📝 任务 4：天空盒系统（1-2天）

**为什么需要？**
- 提供场景背景
- 增强沉浸感
- 环境映射的数据源

**实现内容：**

1. **创建 Skybox 类** (`Skybox.h/cpp`)
   - 立方体贴图加载（6张纹理）
   - 特殊的天空盒着色器
   - 渲染顺序管理

2. **技术细节：**
   - 使用立方体网格
   - 深度测试技巧（skybox 永远在最远处）
   - 去除平移变换（只保留旋转）

3. **天空盒着色器：**
   - `skyboxVertex.glsl`
   - `skyboxFragment.glsl`

4. **测试方法：**
   - 加载一套天空盒纹理
   - 验证环顾四周时天空盒正确显示

**预计时间：** 1天

**需要的资源：**
- 夏季天空盒（6张图：front, back, left, right, top, bottom）
- 冬季天空盒（6张图）

**推荐资源网站：**
- learnopengl.com/Advanced-OpenGL/Cubemaps
- 或搜索 "free skybox textures"

---

### 📝 任务 5：OBJ 模型加载（2-3天）

**为什么需要？**
- 添加树木、岩石等场景元素
- 课程要求

**实现内容：**

1. **创建 Mesh 和 OBJLoader 类**
   - `Mesh.h/cpp` - 网格数据结构
   - `OBJLoader.h/cpp` - 解析 .obj 文件

2. **OBJ 解析：**
   - 读取顶点位置 (v)
   - 读取纹理坐标 (vt)
   - 读取法向量 (vn)
   - 解析面数据 (f)

3. **简化方案（推荐）：**
   - 只支持三角形面
   - 不支持材质文件 (.mtl)
   - 手动在代码中设置材质

4. **测试方法：**
   - 加载一个简单的 .obj 模型（如立方体）
   - 在场景中渲染
   - 应用纹理和光照

**预计时间：** 2-3天

**需要的资源：**
- 树木 .obj 模型（2-3个）
- 岩石 .obj 模型（1-2个）

**难点：**
- OBJ 文件格式解析
- 索引重建

**简化建议：**
- 使用现成的库如 tinyobjloader（可选）
- 或只支持简单的 OBJ 格式

---

## 第3阶段：场景组织与管理（第3周）

### 📝 任务 6：场景图系统（1-2天）

**为什么需要？**
- 课程要求
- 组织和管理场景中的所有物体

**实现内容：**

1. **创建 SceneNode 类**
   - 树形结构（父子关系）
   - 变换矩阵传播
   - 递归渲染

2. **功能：**
   - 添加/删除子节点
   - 设置局部变换
   - 计算世界变换矩阵
   - 遍历和渲染

3. **场景结构示例：**
   ```
   根节点
   ├── 地形节点
   ├── 树木组节点
   │   ├── 树1
   │   ├── 树2
   │   └── 树3
   └── 岩石组节点
       ├── 岩石1
       └── 岩石2
   ```

**预计时间：** 1-2天

---

### 📝 任务 7：自动相机路径（1-2天）

**为什么需要？**
- 课程要求
- 演示视频中展示场景

**实现内容：**

1. **路径系统：**
   - 定义关键点（3-5个位置）
   - 线性插值或贝塞尔曲线
   - 基于时间的移动

2. **实现方式：**
   - 在 Camera 类中添加 `AutoMove()` 方法
   - 按键切换自动/手动模式

3. **测试方法：**
   - 按 'C' 键启动自动相机
   - 相机沿路径平滑移动
   - 再次按 'C' 切换回手动控制

**预计时间：** 1天

---

## 第4阶段：高级功能（第4周）

### 📝 任务 8：环境映射（1天）

**为什么需要？**
- 课程要求
- 实现水面或冰面反射

**实现内容：**

1. **反射着色器：**
   - 使用天空盒作为环境贴图
   - 计算反射向量
   - 混合反射与基础纹理

2. **应用位置：**
   - 地形上的湖面区域
   - 或冬季场景的冰面

**预计时间：** 1天

---

### 📝 任务 9：后期处理框架（2天）

**为什么需要？**
- 实现时间转换效果的基础

**实现内容：**

1. **FBO（帧缓冲对象）**
   - 渲染到纹理
   - 屏幕四边形

2. **后期处理着色器：**
   - 简单的直通着色器
   - 测试效果（如灰度、反色）

**预计时间：** 1-2天

---

### 📝 任务 10：时间转换效果（2-3天）

**核心任务！**

**实现内容：**

1. **双场景管理：**
   - 冬季场景（雪地纹理、光秃树木、冬季天空）
   - 夏季场景（草地纹理、绿树、夏季天空）

2. **转换效果着色器：**
   - 涟漪溶解效果
   - 或其他创意效果

3. **控制：**
   - 空格键触发转换
   - 2-3秒动画时间

**预计时间：** 2-3天

---

### 📝 任务 11：高级功能选择（2-3天）

**选择一个实现：**

**选项A：阴影映射（推荐）**
- 技术难度：中高
- 视觉效果：显著
- 加分：高

**选项B：简单动画**
- 草地摇摆（顶点着色器）
- 技术难度：低
- 实现快速

**选项C：粒子系统**
- 雪花或树叶飘落
- 技术难度：中
- 视觉效果好

**预计时间：** 2-3天

---

## 第5阶段：最后润色与提交（最后3天）

### 📝 任务 12：整合与测试（1天）

**内容：**
- 所有功能集成
- Bug 修复
- 性能优化
- 最终调试

---

### 📝 任务 13：文档与视频（2天）

**要求：**

1. **文档内容：**
   - 4张以上截图
   - 控制说明
   - 功能列表
   - 技术挑战说明

2. **视频录制：**
   - 展示自动相机路径
   - 演示时间转换
   - 展示所有功能
   - 3-5分钟
   - 上传到 YouTube

3. **提交清单：**
   - 源代码（去除 .vs, .git, x64 文件夹）
   - 文档
   - YouTube 链接

---

## 📋 时间分配建议

### 第1周（已完成 + 任务1-3）
- Day 1-2: 纹理系统
- Day 3-5: 地形生成
- Day 6-7: 光照系统

### 第2周（任务4-6）
- Day 8: 天空盒
- Day 9-11: 模型加载
- Day 12-13: 场景图
- Day 14: 自动相机

### 第3周（任务7-11）
- Day 15: 环境映射
- Day 16-17: 后期处理
- Day 18-20: 时间转换
- Day 21-23: 高级功能

### 第4周（任务12-13）
- Day 24: 整合测试
- Day 25-26: 文档和视频

---

## 💡 关键建议

### 优先级原则
1. **先完成核心功能**（地形、光照、天空盒）
2. **再做高级功能**（阴影、动画等）
3. **最后润色**（转换效果、文档）

### 时间管理
- 每个任务留出 buffer 时间
- 如果某个功能卡住，先跳过，完成其他
- 最后3天必须预留给文档和视频

### 简化策略（如果时间紧张）
1. **地形**：使用简单的高度图
2. **模型**：只用2-3个简单模型
3. **转换效果**：用简单的渐隐渐显
4. **高级功能**：选最简单的（如草地动画）

---

## 🎯 下一步行动

**立即开始：任务1 - 纹理加载系统**

准备好了吗？告诉我：
- "开始任务1" - 我会立即创建纹理加载系统的代码
- 或者你有任何问题，随时问我

---

## 📚 参考资源

### 学习资源
- **LearnOpenGL**（中文版）：learnopengl-cn.github.io
- **YouTube**：The Cherno OpenGL 系列

### 纹理和模型资源
- **纹理**：Poly Haven, ambientCG, OpenGameArt
- **天空盒**：搜索 "free skybox textures"
- **模型**：Sketchfab (CC License), Free3D.com

---

**准备好继续了吗？我们现在就可以开始任务1！** 🚀
